<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>X-MEN MOTO PRO</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Arial', sans-serif; touch-action: none; }
        canvas { display: block; margin: 0 auto; box-shadow: 0 0 20px #f1c40f; }
        .ui { position: absolute; width: 100%; top: 20px; display: flex; justify-content: space-around; color: white; pointer-events: none; z-index: 10; }
        .box { background: rgba(0,0,0,0.7); padding: 5px 15px; border-radius: 10px; border: 1px solid #f1c40f; text-align: center; }
    </style>
</head>
<body>
    <div class="ui">
        <div class="box">SCORE<br><span id="score">0</span></div>
        <div class="box">LEVEL<br><span id="level">1</span></div>
    </div>
    <canvas id="game"></canvas>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        canvas.width = Math.min(window.innerWidth, 400);
        canvas.height = window.innerHeight;

        let score = 0; let level = 1; let speed = 8; let gameActive = true;
    
        const lanes = [canvas.width/6, canvas.width/2, (canvas.width*5/6)];
        let player = { x: lanes[1], y: canvas.height - 150, w: 60, h: 60, targetX: lanes[1] };
        
        const motoImg = new Image();
        motoImg.src = 'https://img.icons8.com/isometric-say-it/100/motorcycle.png';

        let obstacles = [];

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function beep(freq, duration) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.frequency.value = freq;
            gain.gain.value = 0.1;
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + duration);
        }

        function drawRoad() {
            ctx.fillStyle = "#222";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.strokeStyle = "#444";
            ctx.setLineDash([20, 30]);
            ctx.lineWidth = 2;
            [canvas.width/3, canvas.width*2/3].forEach(line => {
                ctx.beginPath(); ctx.moveTo(line, 0); ctx.lineTo(line, canvas.height); ctx.stroke();
            });

            ctx.strokeStyle = "#f1c40f";
            ctx.setLineDash([40, 40]);
            ctx.lineDashOffset -= speed;
            ctx.beginPath(); ctx.moveTo(canvas.width/2, 0); ctx.lineTo(canvas.width/2, canvas.height); ctx.stroke();
        }

        function update() {
            if (!gameActive) return;
            drawRoad();

            player.x += (player.targetX - player.x) * 0.2;
            ctx.drawImage(motoImg, player.x - 30, player.y, 60, 60);

            if (Math.random() < 0.03 + (level * 0.005)) {
                let lane = lanes[Math.floor(Math.random() * lanes.length)];
                obstacles.push({ x: lane, y: -100, w: 50, h: 50, color: `hsl(${Math.random()*360}, 70%, 60%)` });
            }

            obstacles.forEach((ob, i) => {
                ob.y += speed;
                ctx.fillStyle = ob.color;
                ctx.shadowBlur = 15; ctx.shadowColor = ob.color;
                ctx.fillRect(ob.x - 25, ob.y, 50, 50);
                ctx.shadowBlur = 0;

                if (Math.abs(player.x - ob.x) < 40 && Math.abs(player.y - ob.y) < 50) {
                    gameActive = false;
                    beep(100, 0.5);
                    alert("GAME OVER! SCORE: " + score);
                    location.reload();
                }

                if (ob.y > canvas.height) {
                    obstacles.splice(i, 1);
                    score += 10;
                    document.getElementById('score').innerText = score;
                    beep(400, 0.05);
                    if (score % 100 === 0) {
                        level++; speed += 1;
                        document.getElementById('level').innerText = level;
                        beep(800, 0.2);
                    }
                }
            });
            requestAnimationFrame(update);
        }

        window.addEventListener('touchstart', e => {
            let tx = e.touches[0].clientX;
            let sw = window.innerWidth;
            if (tx < sw/3) player.targetX = lanes[0];
            else if (tx < sw*2/3) player.targetX = lanes[1];
            else player.targetX = lanes[2];
        });

        update();
    </script>
</body>
</html>
